(("undefined"!=typeof self?self:this).webpackJsonp=("undefined"!=typeof self?self:this).webpackJsonp||[]).push([[4],Array(394).concat([function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/909.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/909b.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/909closed.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/909open.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/CARinsect.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/Cryptotympana.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/Dundunia.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/InsectBee.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/InsectBee2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/InsectFly.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/InsecticideZG.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/Macrosemia.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/MacrosemiaTonk.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/MeimunaNau.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/auboom.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/auboom2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/auclick.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/audoubelclick2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/audoubleclick.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/auhiclick.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/ausiclick.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/backswing-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/bee.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/bello.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/bellrip.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/bellrip2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/bellrip3.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/bellx.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/birta.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/blade-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/boom.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/boom2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/boomwag.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/camclick-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/camina1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/camina2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/camina3.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/camina4.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/chain.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/chainSpade.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/click-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/click.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/clicko-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/clicko.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/clicks1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/convol1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/convol2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/convol3.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/convol4.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/convol5.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/crackle3.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/crickBee.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/dalispark.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/dentist-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/digaa.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/dorje.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/drone1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/drone2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/drr.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/electro.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/elstatic-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/firecrack.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/firespark.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/firespark2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/flash-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/glitch-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/hapsi.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/harshi-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/harshlow-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/heart.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/holeMONO.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/ice.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/insec.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/insec2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/insec3.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/insectzapZG.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/iron.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/ironrip.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/jump.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/kernel.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/kernel2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/kerneldrone.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/kernelmix.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/kicic.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/kicic2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/kicicboom.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/knock.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/laekur.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/lookout.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/machine.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/magnetclock-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/noinoi.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/noise-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/noise1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/noise2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/paper.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/pattern10.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/pattern11.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/pattern8.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/pattern9.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/patterndrone.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/patterndrone2.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/patterndrone3.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/phoo-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/pork.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/rain_ravi.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/ravi.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/revbell.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/rocks.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/rotatingIron.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/sbq.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/skake2Ed.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/snork.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/snow.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/spade.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/spark.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/stretch.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/sweetmachine-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/swipe-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/triplet.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/vindva.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/vindvabd.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/vindvaclick.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/vindvadbase.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/vindvahat.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/viromachine-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/woodsamp.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/wooo-old1.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/xylophone.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/zhish.wav"},function(e,t,i){"use strict";i.r(t),t.default=i.p+"samples/zzzz.wav"},,,,,function(e,t,i){!function e(t,i,n){function a(s,r){if(!i[s]){if(!t[s]){if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};t[s][0].call(u.exports,(function(e){return a(t[s][1][e]||e)}),u,u.exports,e,t,i,n)}return i[s].exports}for(var o=!1,s=0;s<n.length;s++)a(n[s]);return a}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,i.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,i.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate},{}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("./util"),a=e("eventemitter3"),o=e("./negotiator"),s=e("reliable");function r(e,t,i){if(!(this instanceof r))return new r(e,t,i);a.EventEmitter.call(this),this.options=n.util.extend({serialization:"binary",reliable:!1},i),this.open=!1,this.type="data",this.peer=e,this.provider=t,this.id=this.options.connectionId||r._idPrefix+n.util.randomToken(),this.label=this.options.label||this.id,this.metadata=this.options.metadata,this.serialization=this.options.serialization,this.reliable=this.options.reliable,this._buffer=[],this._buffering=!1,this.bufferSize=0,this._chunkedData={},this.options._payload&&(this._peerBrowser=this.options._payload.browser),o.Negotiator.startConnection(this,this.options._payload||{originator:!0})}i.DataConnection=r,n.util.inherits(r,a.EventEmitter),r._idPrefix="dc_",r.prototype.initialize=function(e){this._dc=this.dataChannel=e,this._configureDataChannel()},r.prototype._configureDataChannel=function(){var e=this;n.util.supports.sctp&&(this._dc.binaryType="arraybuffer"),this._dc.onopen=function(){n.util.log("Data channel connection success"),e.open=!0,e.emit("open")},!n.util.supports.sctp&&this.reliable&&(this._reliable=new s.Reliable(this._dc,n.util.debug)),this._reliable?this._reliable.onmessage=function(t){e.emit("data",t)}:this._dc.onmessage=function(t){e._handleDataMessage(t)},this._dc.onclose=function(t){n.util.log("DataChannel closed for:",e.peer),e.close()}},r.prototype._handleDataMessage=function(e){var t=this,i=e.data,a=i.constructor;if("binary"===this.serialization||"binary-utf8"===this.serialization){if(a===Blob)return void n.util.blobToArrayBuffer(i,(function(e){i=n.util.unpack(e),t.emit("data",i)}));if(a===ArrayBuffer)i=n.util.unpack(i);else if(a===String){var o=n.util.binaryStringToArrayBuffer(i);i=n.util.unpack(o)}}else"json"===this.serialization&&(i=JSON.parse(i));if(i.__peerData){var s=i.__peerData,r=this._chunkedData[s]||{data:[],count:0,total:i.total};return r.data[i.n]=i.data,r.count+=1,r.total===r.count&&(delete this._chunkedData[s],i=new Blob(r.data),this._handleDataMessage({data:i})),void(this._chunkedData[s]=r)}this.emit("data",i)},r.prototype.close=function(){this.open&&(this.open=!1,o.Negotiator.cleanup(this),this.emit("close"))},r.prototype.send=function(e,t){if(this.open)if(this._reliable)this._reliable.send(e);else{var i=this;if("json"===this.serialization)this._bufferedSend(JSON.stringify(e));else if("binary"===this.serialization||"binary-utf8"===this.serialization){var a=n.util.pack(e);if((n.util.chunkedBrowsers[this._peerBrowser]||n.util.chunkedBrowsers[n.util.browser])&&!t&&a.size>n.util.chunkedMTU)return void this._sendChunks(a);n.util.supports.sctp?n.util.supports.binaryBlob?this._bufferedSend(a):n.util.blobToArrayBuffer(a,(function(e){i._bufferedSend(e)})):n.util.blobToBinaryString(a,(function(e){i._bufferedSend(e)}))}else this._bufferedSend(e)}else this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages."))},r.prototype._bufferedSend=function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this.bufferSize=this._buffer.length)},r.prototype._trySend=function(e){try{this._dc.send(e)}catch(e){this._buffering=!0;var t=this;return setTimeout((function(){t._buffering=!1,t._tryBuffer()}),100),!1}return!0},r.prototype._tryBuffer=function(){if(0!==this._buffer.length){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this.bufferSize=this._buffer.length,this._tryBuffer())}},r.prototype._sendChunks=function(e){for(var t=n.util.chunk(e),i=0,a=t.length;i<a;i+=1)e=t[i],this.send(e,!0)},r.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case"ANSWER":this._peerBrowser=t.browser,o.Negotiator.handleSDP(e.type,this,t.sdp);break;case"CANDIDATE":o.Negotiator.handleCandidate(this,t.candidate);break;default:n.util.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}}},{"./negotiator":5,"./util":8,eventemitter3:9,reliable:12}],3:[function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0});var a=e("./util"),o=e("./adapter"),s=e("./socket"),r=e("./mediaconnection"),c=e("./dataconnection"),u=e("./peer"),l=e("./negotiator"),p=n(e("js-binarypack"));window.Socket=s.Socket,window.MediaConnection=r.MediaConnection,window.DataConnection=c.DataConnection,window.Peer=u.Peer,window.RTCPeerConnection=o.RTCPeerConnection,window.RTCSessionDescription=o.RTCSessionDescription,window.RTCIceCandidate=o.RTCIceCandidate,window.Negotiator=l.Negotiator,window.util=a.util,window.BinaryPack=p.default},{"./adapter":1,"./dataconnection":2,"./mediaconnection":4,"./negotiator":5,"./peer":6,"./socket":7,"./util":8,"js-binarypack":10}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("./util"),a=e("eventemitter3"),o=e("./negotiator");function s(e,t,i){if(!(this instanceof s))return new s(e,t,i);a.EventEmitter.call(this),this.options=n.util.extend({},i),this.open=!1,this.type="media",this.peer=e,this.provider=t,this.metadata=this.options.metadata,this.localStream=this.options._stream,this.id=this.options.connectionId||s._idPrefix+n.util.randomToken(),this.localStream&&o.Negotiator.startConnection(this,{_stream:this.localStream,originator:!0})}i.MediaConnection=s,n.util.inherits(s,a.EventEmitter),s._idPrefix="mc_",s.prototype.addStream=function(e){n.util.log("Receiving stream",e),this.remoteStream=e,this.emit("stream",e)},s.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case"ANSWER":o.Negotiator.handleSDP(e.type,this,t.sdp),this.open=!0;break;case"CANDIDATE":o.Negotiator.handleCandidate(this,t.candidate);break;default:n.util.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},s.prototype.answer=function(e){if(this.localStream)n.util.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this.options._payload._stream=e,this.localStream=e,o.Negotiator.startConnection(this,this.options._payload);for(var t=this.provider._getMessages(this.id),i=0,a=t.length;i<a;i+=1)this.handleMessage(t[i]);this.open=!0}},s.prototype.close=function(){this.open&&(this.open=!1,o.Negotiator.cleanup(this),this.emit("close"))}},{"./negotiator":5,"./util":8,eventemitter3:9}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("./util"),a=e("./adapter");i.Negotiator={pcs:{data:{},media:{}},queue:[]},i.Negotiator._idPrefix="pc_",i.Negotiator.startConnection=function(e,t){var a=i.Negotiator._getPeerConnection(e,t);if(e.pc=e.peerConnection=a,"media"===e.type&&t._stream&&a.addStream(t._stream),t.originator){if("data"===e.type){var o={};n.util.supports.sctp||(o={reliable:t.reliable});var s=a.createDataChannel(e.label,o);e.initialize(s)}i.Negotiator._makeOffer(e)}else i.Negotiator.handleSDP("OFFER",e,t.sdp)},i.Negotiator._getPeerConnection=function(e,t){var a;return i.Negotiator.pcs[e.type]||n.util.error(e.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere."),i.Negotiator.pcs[e.type][e.peer]||(i.Negotiator.pcs[e.type][e.peer]={}),i.Negotiator.pcs[e.type][e.peer],t.pc&&(a=i.Negotiator.pcs[e.type][e.peer][t.pc]),a&&"stable"===a.signalingState||(a=i.Negotiator._startPeerConnection(e)),a},i.Negotiator._startPeerConnection=function(e){n.util.log("Creating RTCPeerConnection.");var t=i.Negotiator._idPrefix+n.util.randomToken(),o={};"data"!==e.type||n.util.supports.sctp?"media"===e.type&&(o={optional:[{DtlsSrtpKeyAgreement:!0}]}):o={optional:[{RtpDataChannels:!0}]};var s=new a.RTCPeerConnection(e.provider.options.config,o);return i.Negotiator.pcs[e.type][e.peer][t]=s,i.Negotiator._setupListeners(e,s,t),s},i.Negotiator._setupListeners=function(e,t,i){var a=e.peer,o=e.id,s=e.provider;n.util.log("Listening for ICE candidates."),t.onicecandidate=function(t){t.candidate&&(n.util.log("Received ICE candidates for:",e.peer),s.socket.send({type:"CANDIDATE",payload:{candidate:t.candidate,type:e.type,connectionId:e.id},dst:a}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"failed":n.util.log("iceConnectionState is disconnected, closing connections to "+a),e.emit("error",new Error("Negotiation of connection to "+a+" failed.")),e.close();break;case"disconnected":n.util.log("iceConnectionState is disconnected, closing connections to "+a),e.close();break;case"completed":t.onicecandidate=n.util.noop}},t.onicechange=t.oniceconnectionstatechange,n.util.log("Listening for data channel"),t.ondatachannel=function(e){n.util.log("Received data channel");var t=e.channel;s.getConnection(a,o).initialize(t)},n.util.log("Listening for remote stream"),t.ontrack=function(e){n.util.log("Received remote stream");var t=e.streams[0],i=s.getConnection(a,o);"media"===i.type&&i.addStream(t)}},i.Negotiator.cleanup=function(e){n.util.log("Cleaning up PeerConnection to "+e.peer);var t=e.pc;t&&(t.readyState&&"closed"!==t.readyState||"closed"!==t.signalingState)&&(t.close(),e.pc=null)},i.Negotiator._makeOffer=function(e){var t=e.pc;t.createOffer((function(i){n.util.log("Created offer."),!n.util.supports.sctp&&"data"===e.type&&e.reliable&&(i.sdp=Reliable.higherBandwidthSDP(i.sdp)),t.setLocalDescription(i,(function(){n.util.log("Set localDescription: offer","for:",e.peer),e.provider.socket.send({type:"OFFER",payload:{sdp:i,type:e.type,label:e.label,connectionId:e.id,reliable:e.reliable,serialization:e.serialization,metadata:e.metadata,browser:n.util.browser},dst:e.peer})}),(function(t){"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=t&&(e.provider.emitError("webrtc",t),n.util.log("Failed to setLocalDescription, ",t))}))}),(function(t){e.provider.emitError("webrtc",t),n.util.log("Failed to createOffer, ",t)}),e.options.constraints)},i.Negotiator._makeAnswer=function(e){var t=e.pc;t.createAnswer((function(i){n.util.log("Created answer."),!n.util.supports.sctp&&"data"===e.type&&e.reliable&&(i.sdp=Reliable.higherBandwidthSDP(i.sdp)),t.setLocalDescription(i,(function(){n.util.log("Set localDescription: answer","for:",e.peer),e.provider.socket.send({type:"ANSWER",payload:{sdp:i,type:e.type,connectionId:e.id,browser:n.util.browser},dst:e.peer})}),(function(t){e.provider.emitError("webrtc",t),n.util.log("Failed to setLocalDescription, ",t)}))}),(function(t){e.provider.emitError("webrtc",t),n.util.log("Failed to create answer, ",t)}))},i.Negotiator.handleSDP=function(e,t,o){o=new a.RTCSessionDescription(o);var s=t.pc;n.util.log("Setting remote description",o),s.setRemoteDescription(o,(function(){n.util.log("Set remoteDescription:",e,"for:",t.peer),"OFFER"===e&&i.Negotiator._makeAnswer(t)}),(function(e){t.provider.emitError("webrtc",e),n.util.log("Failed to setRemoteDescription, ",e)}))},i.Negotiator.handleCandidate=function(e,t){var i=t.candidate,o=t.sdpMLineIndex;e.pc.addIceCandidate(new a.RTCIceCandidate({sdpMLineIndex:o,candidate:i})),n.util.log("Added ICE candidate for:",e.peer)}},{"./adapter":1,"./util":8}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("./util"),a=e("eventemitter3"),o=e("./socket"),s=e("./mediaconnection"),r=e("./dataconnection");function c(e,t){if(!(this instanceof c))return new c(e,t);a.EventEmitter.call(this),e&&e.constructor==Object?(t=e,e=void 0):e&&(e=e.toString()),(t=n.util.extend({debug:0,host:n.util.CLOUD_HOST,port:n.util.CLOUD_PORT,path:"/",token:n.util.randomToken(),config:n.util.defaultConfig},t)).key="peerjs","/"===(this.options=t).host&&(t.host=window.location.hostname),"/"!==t.path[0]&&(t.path="/"+t.path),"/"!==t.path[t.path.length-1]&&(t.path+="/"),void 0===t.secure&&t.host!==n.util.CLOUD_HOST?t.secure=n.util.isSecure():t.host==n.util.CLOUD_HOST&&(t.secure=!0),t.logFunction&&n.util.setLogFunction(t.logFunction),n.util.setLogLevel(t.debug),n.util.supports.audioVideo||n.util.supports.data?n.util.validateId(e)?(this.destroyed=!1,this.disconnected=!1,this.open=!1,this.connections={},this._lostMessages={},this._initializeServerConnection(),e?this._initialize(e):this._retrieveId()):this._delayedAbort("invalid-id",'ID "'+e+'" is invalid'):this._delayedAbort("browser-incompatible","The current browser does not support WebRTC")}i.Peer=c,n.util.inherits(c,a.EventEmitter),c.prototype._initializeServerConnection=function(){var e=this;this.socket=new o.Socket(this.options.secure,this.options.host,this.options.port,this.options.path,this.options.key,this.options.wsport),this.socket.on("message",(function(t){e._handleMessage(t)})),this.socket.on("error",(function(t){e._abort("socket-error",t)})),this.socket.on("disconnected",(function(){e.disconnected||(e.emitError("network","Lost connection to server."),e.disconnect())})),this.socket.on("close",(function(){e.disconnected||e._abort("socket-closed","Underlying socket is already closed.")}))},c.prototype._retrieveId=function(e){var t=this,i=new XMLHttpRequest,a=(this.options.secure?"https://":"http://")+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/id";a+="?ts="+(new Date).getTime()+Math.random(),i.open("get",a,!0),i.onerror=function(e){n.util.error("Error retrieving ID",e);var i="";"/"===t.options.path&&t.options.host!==n.util.CLOUD_HOST&&(i=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),t._abort("server-error","Could not get an ID from the server."+i)},i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t._initialize(i.responseText):i.onerror())},i.send(null)},c.prototype._initialize=function(e){this.id=e,this.socket.start(this.id,this.options.token)},c.prototype._handleMessage=function(e){var t,i=e.type,a=e.payload,o=e.src;switch(i){case"OPEN":this.emit("open",this.id),this.open=!0;break;case"ERROR":this._abort("server-error",a.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":n.util.log("Received leave message from",o),this._cleanupPeer(o);break;case"EXPIRE":this.emitError("peer-unavailable","Could not connect to peer "+o);break;case"OFFER":var c=a.connectionId;if((t=this.getConnection(o,c))&&(t.close(),n.util.warn("Offer received for existing Connection ID:",c)),"media"===a.type)t=new s.MediaConnection(o,this,{connectionId:c,_payload:a,metadata:a.metadata}),this._addConnection(o,t),this.emit("call",t);else{if("data"!==a.type)return void n.util.warn("Received malformed connection type:",a.type);t=new r.DataConnection(o,this,{connectionId:c,_payload:a,metadata:a.metadata,label:a.label,serialization:a.serialization,reliable:a.reliable}),this._addConnection(o,t),this.emit("connection",t)}for(var u=this._getMessages(c),l=0,p=u.length;l<p;l+=1)t.handleMessage(u[l]);break;default:if(!a)return void n.util.warn("You received a malformed message from "+o+" of type "+i);var d=a.connectionId;(t=this.getConnection(o,d))&&t.pc?t.handleMessage(e):d?this._storeMessage(d,e):n.util.warn("You received an unrecognized message:",e)}},c.prototype._storeMessage=function(e,t){this._lostMessages[e]||(this._lostMessages[e]=[]),this._lostMessages[e].push(t)},c.prototype._getMessages=function(e){var t=this._lostMessages[e];return t?(delete this._lostMessages[e],t):[]},c.prototype.connect=function(e,t){if(this.disconnected)return n.util.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");var i=new r.DataConnection(e,this,t);return this._addConnection(e,i),i},c.prototype.call=function(e,t,i){if(this.disconnected)return n.util.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");if(t){(i=i||{})._stream=t;var a=new s.MediaConnection(e,this,i);return this._addConnection(e,a),a}n.util.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},c.prototype._addConnection=function(e,t){this.connections[e]||(this.connections[e]=[]),this.connections[e].push(t)},c.prototype.getConnection=function(e,t){var i=this.connections[e];if(!i)return null;for(var n=0,a=i.length;n<a;n++)if(i[n].id===t)return i[n];return null},c.prototype._delayedAbort=function(e,t){var i=this;n.util.setZeroTimeout((function(){i._abort(e,t)}))},c.prototype._abort=function(e,t){n.util.error("Aborting!"),this._lastServerId?this.disconnect():this.destroy(),this.emitError(e,t)},c.prototype.emitError=function(e,t){n.util.error("Error:",t),"string"==typeof t&&(t=new Error(t)),t.type=e,this.emit("error",t)},c.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this.destroyed=!0)},c.prototype._cleanup=function(){if(this.connections)for(var e=Object.keys(this.connections),t=0,i=e.length;t<i;t++)this._cleanupPeer(e[t]);this.emit("close")},c.prototype._cleanupPeer=function(e){for(var t=this.connections[e],i=0,n=t.length;i<n;i+=1)t[i].close()},c.prototype.disconnect=function(){var e=this;n.util.setZeroTimeout((function(){e.disconnected||(e.disconnected=!0,e.open=!1,e.socket&&e.socket.close(),e.emit("disconnected",e.id),e._lastServerId=e.id,e.id=null)}))},c.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)n.util.log("Attempting reconnection to server with ID "+this._lastServerId),this.disconnected=!1,this._initializeServerConnection(),this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");n.util.error("In a hurry? We're still trying to make the initial connection!")}},c.prototype.listAllPeers=function(e){e=e||function(){};var t=this,i=new XMLHttpRequest,a=(this.options.secure?"https://":"http://")+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/peers";a+="?ts="+(new Date).getTime()+Math.random(),i.open("get",a,!0),i.onerror=function(i){t._abort("server-error","Could not get peers from the server."),e([])},i.onreadystatechange=function(){if(4===i.readyState){if(401===i.status){var a;throw a=t.options.host!==n.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",e([]),new Error("It doesn't look like you have permission to list peers IDs. "+a)}200!==i.status?e([]):e(JSON.parse(i.responseText))}},i.send(null)}},{"./dataconnection":2,"./mediaconnection":4,"./socket":7,"./util":8,eventemitter3:9}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("./util"),a=e("eventemitter3");function o(e,t,i,n,s,r){if(!(this instanceof o))return new o(e,t,i,n,s,r);r=r||i,a.EventEmitter.call(this),this.disconnected=!1,this._queue=[];var c=e?"https://":"http://",u=e?"wss://":"ws://";this._httpUrl=c+t+":"+i+n+s,this._wsUrl=u+t+":"+r+n+"peerjs?key="+s}i.Socket=o,n.util.inherits(o,a.EventEmitter),o.prototype.start=function(e,t){this.id=e,this._httpUrl+="/"+e+"/"+t,this._wsUrl+="&id="+e+"&token="+t,this._startXhrStream(),this._startWebSocket()},o.prototype._startWebSocket=function(e){var t=this;this._socket||(this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(e){try{var i=JSON.parse(e.data)}catch(i){return void n.util.log("Invalid server message",e.data)}t.emit("message",i)},this._socket.onclose=function(e){n.util.log("Socket closed."),t.disconnected=!0,t.emit("disconnected")},this._socket.onopen=function(){t._timeout&&(clearTimeout(t._timeout),setTimeout((function(){t._http.abort(),t._http=null}),5e3)),t._sendQueuedMessages(),n.util.log("Socket open")})},o.prototype._startXhrStream=function(e){try{var t=this;this._http=new XMLHttpRequest,this._http._index=1,this._http._streamIndex=e||0,this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,!0),this._http.onerror=function(){clearTimeout(t._timeout),t.emit("disconnected")},this._http.onreadystatechange=function(){2==this.readyState&&this.old?(this.old.abort(),delete this.old):2<this.readyState&&200===this.status&&this.responseText&&t._handleStream(this)},this._http.send(null),this._setHTTPTimeout()}catch(e){n.util.log("XMLHttpRequest not available; defaulting to WebSockets")}},o.prototype._handleStream=function(e){var t=e.responseText.split("\n");if(e._buffer)for(;0<e._buffer.length;){var i=e._buffer.shift(),a=t[i];try{a=JSON.parse(a)}catch(t){e._buffer.shift(i);break}this.emit("message",a)}var o=t[e._index];if(o)if(e._index+=1,e._index===t.length)e._buffer||(e._buffer=[]),e._buffer.push(e._index-1);else{try{o=JSON.parse(o)}catch(t){return void n.util.log("Invalid server message",o)}this.emit("message",o)}},o.prototype._setHTTPTimeout=function(){var e=this;this._timeout=setTimeout((function(){var t=e._http;e._wsOpen()?t.abort():(e._startXhrStream(t._streamIndex+1),e._http.old=t)}),25e3)},o.prototype._wsOpen=function(){return this._socket&&1==this._socket.readyState},o.prototype._sendQueuedMessages=function(){for(var e=0,t=this._queue.length;e<t;e+=1)this.send(this._queue[e])},o.prototype.send=function(e){if(!this.disconnected)if(this.id)if(e.type){var t=JSON.stringify(e);if(this._wsOpen())this._socket.send(t);else{var i=new XMLHttpRequest,n=this._httpUrl+"/"+e.type.toLowerCase();i.open("post",n,!0),i.setRequestHeader("Content-Type","application/json"),i.send(t)}}else this.emit("error","Invalid message");else this._queue.push(e)},o.prototype.close=function(){!this.disconnected&&this._wsOpen()&&(this._socket.close(),this.disconnected=!0)}},{"./util":8,eventemitter3:9}],8:[function(e,t,i){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0});var a={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},o=1,s=n(e("js-binarypack")),r=e("./adapter");i.util={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:443,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(e){var t=parseInt(e,10);isNaN(parseInt(e,10))?i.util.logLevel=e?3:0:i.util.logLevel=t,i.util.log=i.util.warn=i.util.error=i.util.noop,0<i.util.logLevel&&(i.util.error=i.util._printWith("ERROR")),1<i.util.logLevel&&(i.util.warn=i.util._printWith("WARNING")),2<i.util.logLevel&&(i.util.log=i.util._print)},setLogFunction:function(e){e.constructor!==Function?i.util.warn("The log function you passed in is not a function. Defaulting to regular logs."):i.util._print=e},_printWith:function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),i.util._print.apply(i.util,t)}},_print:function(){var e=!1,t=Array.prototype.slice.call(arguments);t.unshift("PeerJS: ");for(var i=0,n=t.length;i<n;i++)t[i]instanceof Error&&(t[i]="("+t[i].name+") "+t[i].message,e=!0);e?console.error.apply(console,t):console.log.apply(console,t)},defaultConfig:a,browser:window.mozRTCPeerConnection?"Firefox":window.webkitRTCPeerConnection?"Chrome":window.RTCPeerConnection?"Supported":"Unsupported",supports:function(){if(void 0===r.RTCPeerConnection)return{};var e,t,i=!0,n=!0,o=!1,s=!1,c=!!window.webkitRTCPeerConnection;try{e=new r.RTCPeerConnection(a,{optional:[{RtpDataChannels:!0}]})}catch(e){n=i=!1}if(i)try{t=e.createDataChannel("_PEERJSTEST")}catch(e){i=!1}if(i){try{t.binaryType="blob",o=!0}catch(e){}var u=new r.RTCPeerConnection(a,{});try{s=u.createDataChannel("_PEERJSRELIABLETEST",{}).reliable}catch(e){}u.close()}return n&&(n=!!e.addStream),e&&e.close(),{audioVideo:n,data:i,binaryBlob:o,binary:s,reliable:s,sctp:s,onnegotiationneeded:c}}(),validateId:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},validateKey:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},debug:!1,inherits:function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},pack:s.default.pack,unpack:s.default.unpack,log:function(){if(i.util.debug){var e=!1,t=Array.prototype.slice.call(arguments);t.unshift("PeerJS: ");for(var n=0,a=t.length;n<a;n++)t[n]instanceof Error&&(t[n]="("+t[n].name+") "+t[n].message,e=!0);e?console.error.apply(console,t):console.log.apply(console,t)}},setZeroTimeout:function(e){var t=[],i="zero-timeout-message";function n(n){n.source==e&&n.data==i&&(n.stopPropagation&&n.stopPropagation(),t.length&&t.shift()())}return e.addEventListener?e.addEventListener("message",n,!0):e.attachEvent&&e.attachEvent("onmessage",n),function(n){t.push(n),e.postMessage(i,"*")}}(window),chunk:function(e){for(var t,n=[],a=e.size,s=t=0,r=Math.ceil(a/i.util.chunkedMTU);s<a;){var c=Math.min(a,s+i.util.chunkedMTU),u=e.slice(s,c),l={__peerData:o,n:t,data:u,total:r};n.push(l),s=c,t+=1}return o+=1,n},blobToArrayBuffer:function(e,t){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsArrayBuffer(e)},blobToBinaryString:function(e,t){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return"https:"===location.protocol}}},{"./adapter":1,"js-binarypack":10}],9:[function(e,t,i){"use strict";function n(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function a(){}a.prototype._events=void 0,a.prototype.listeners=function(e){if(!this._events||!this._events[e])return[];if(this._events[e].fn)return[this._events[e].fn];for(var t=0,i=this._events[e].length,n=new Array(i);t<i;t++)n[t]=this._events[e][t].fn;return n},a.prototype.emit=function(e,t,i,n,a,o){if(!this._events||!this._events[e])return!1;var s,r,c=this._events[e],u=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(e,c.fn,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,n),!0;case 5:return c.fn.call(c.context,t,i,n,a),!0;case 6:return c.fn.call(c.context,t,i,n,a,o),!0}for(r=1,s=new Array(u-1);r<u;r++)s[r-1]=arguments[r];c.fn.apply(c.context,s)}else{var l,p=c.length;for(r=0;r<p;r++)switch(c[r].once&&this.removeListener(e,c[r].fn,!0),u){case 1:c[r].fn.call(c[r].context);break;case 2:c[r].fn.call(c[r].context,t);break;case 3:c[r].fn.call(c[r].context,t,i);break;default:if(!s)for(l=1,s=new Array(u-1);l<u;l++)s[l-1]=arguments[l];c[r].fn.apply(c[r].context,s)}}return!0},a.prototype.on=function(e,t,i){var a=new n(t,i||this);return this._events||(this._events={}),this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],a]:this._events[e].push(a):this._events[e]=a,this},a.prototype.once=function(e,t,i){var a=new n(t,i||this,!0);return this._events||(this._events={}),this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],a]:this._events[e].push(a):this._events[e]=a,this},a.prototype.removeListener=function(e,t,i){if(!this._events||!this._events[e])return this;var n=this._events[e],a=[];if(t&&(n.fn&&(n.fn!==t||i&&!n.once)&&a.push(n),!n.fn))for(var o=0,s=n.length;o<s;o++)(n[o].fn!==t||i&&!n[o].once)&&a.push(n[o]);return a.length?this._events[e]=1===a.length?a[0]:a:delete this._events[e],this},a.prototype.removeAllListeners=function(e){return this._events&&(e?delete this._events[e]:this._events={}),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prototype.setMaxListeners=function(){return this},((a.EventEmitter=a).EventEmitter2=a).EventEmitter3=a,t.exports=a},{}],10:[function(e,t,i){var n=e("./bufferbuilder").BufferBuilder,a=e("./bufferbuilder").binaryFeatures,o={unpack:function(e){return new s(e).unpack()},pack:function(e){var t=new r;return t.pack(e),t.getBuffer()}};function s(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function r(){this.bufferBuilder=new n}function c(e){var t=e.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}t.exports=o,s.prototype.unpack=function(){var e,t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},s.prototype.unpack_uint8=function(){var e=255&this.dataView[this.index];return this.index++,e},s.prototype.unpack_uint16=function(){var e=this.read(2),t=256*(255&e[0])+(255&e[1]);return this.index+=2,t},s.prototype.unpack_uint32=function(){var e=this.read(4),t=256*(256*(256*e[0]+e[1])+e[2])+e[3];return this.index+=4,t},s.prototype.unpack_uint64=function(){var e=this.read(8),t=256*(256*(256*(256*(256*(256*(256*e[0]+e[1])+e[2])+e[3])+e[4])+e[5])+e[6])+e[7];return this.index+=8,t},s.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-256},s.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-65536},s.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},s.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},s.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},s.prototype.unpack_string=function(e){for(var t,i,n=this.read(e),a=0,o="";a<e;)(t=n[a])<128?(o+=String.fromCharCode(t),a++):(192^t)<32?(i=(192^t)<<6|63&n[a+1],o+=String.fromCharCode(i),a+=2):(i=(15&t)<<12|(63&n[a+1])<<6|63&n[a+2],o+=String.fromCharCode(i),a+=3);return this.index+=e,o},s.prototype.unpack_array=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=this.unpack();return t},s.prototype.unpack_map=function(e){for(var t={},i=0;i<e;i++){var n=this.unpack(),a=this.unpack();t[n]=a}return t},s.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=(e>>23&255)-127;return(0==e>>31?1:-1)*(8388607&e|8388608)*Math.pow(2,t-23)},s.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),i=(e>>20&2047)-1023;return(0==e>>31?1:-1)*((1048575&e|1048576)*Math.pow(2,i-20)+t*Math.pow(2,i-52))},s.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},r.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},r.prototype.pack=function(e){var t=typeof e;if("string"==t)this.pack_string(e);else if("number"==t)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"==t)!0===e?this.bufferBuilder.append(195):!1===e&&this.bufferBuilder.append(194);else if("undefined"==t)this.bufferBuilder.append(192);else{if("object"!=t)throw new Error('Type "'+t+'" not yet supported');if(null===e)this.bufferBuilder.append(192);else{var i=e.constructor;if(i==Array)this.pack_array(e);else if(i==Blob||i==File)this.pack_bin(e);else if(i==ArrayBuffer)a.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)a.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(i==Object)this.pack_object(e);else if(i==Date)this.pack_string(e.toString());else{if("function"!=typeof e.toBinaryPack)throw new Error('Type "'+i.toString()+'" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},r.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},r.prototype.pack_string=function(e){var t,i=600<(t=e).length?new Blob([t]).size:t.replace(/[^\u0000-\u007F]/g,c).length;if(i<=15)this.pack_uint8(176+i);else if(i<=65535)this.bufferBuilder.append(216),this.pack_uint16(i);else{if(!(i<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(i)}this.bufferBuilder.append(e)},r.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var i=0;i<t;i++)this.pack(e[i])},r.prototype.pack_integer=function(e){if(-32<=e&&e<=127)this.bufferBuilder.append(255&e);else if(0<=e&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(-128<=e&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(0<=e&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(-32768<=e&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(0<=e&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(-2147483648<=e&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(-0x8000000000000000<=e&&e<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(0<=e&&e<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},r.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var i=Math.floor(Math.log(e)/Math.LN2),n=e/Math.pow(2,i)-1,a=Math.floor(n*Math.pow(2,52)),o=Math.pow(2,32),s=t<<31|i+1023<<20|a/o&1048575,r=a%o;this.bufferBuilder.append(203),this.pack_int32(s),this.pack_int32(r)},r.prototype.pack_object=function(e){var t=Object.keys(e).length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(t)}for(var i in e)e.hasOwnProperty(i)&&(this.pack(i),this.pack(e[i]))},r.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},r.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(255&e)},r.prototype.pack_uint32=function(e){var t=4294967295&e;this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},r.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),i=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&i)>>>24),this.bufferBuilder.append((16711680&i)>>>16),this.bufferBuilder.append((65280&i)>>>8),this.bufferBuilder.append(255&i)},r.prototype.pack_int8=function(e){this.bufferBuilder.append(255&e)},r.prototype.pack_int16=function(e){this.bufferBuilder.append((65280&e)>>8),this.bufferBuilder.append(255&e)},r.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},r.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),i=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&i)>>>24),this.bufferBuilder.append((16711680&i)>>>16),this.bufferBuilder.append((65280&i)>>>8),this.bufferBuilder.append(255&i)}},{"./bufferbuilder":11}],11:[function(e,t,i){var n={};n.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),n.useArrayBufferView=!n.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(e){return!0}}(),t.exports.binaryFeatures=n;var a=t.exports.BlobBuilder;function o(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(a=t.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),o.prototype.append=function(e){"number"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},o.prototype.flush=function(){if(0<this._pieces.length){var e=new Uint8Array(this._pieces);n.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},o.prototype.getBuffer=function(){if(this.flush(),n.useBlobBuilder){for(var e=new a,t=0,i=this._parts.length;t<i;t++)e.append(this._parts[t]);return e.getBlob()}return new Blob(this._parts)},t.exports.BufferBuilder=o},{}],12:[function(e,t,i){var n=e("./util");function a(e,t){if(!(this instanceof a))return new a(e);this._dc=e,n.debug=t,this._outgoing={},this._incoming={},this._received={},this._window=1e3,this._mtu=500,this._interval=0,this._count=0,this._queue=[],this._setupDC()}a.prototype.send=function(e){var t=n.pack(e);t.size<this._mtu?this._handleSend(["no",t]):(this._outgoing[this._count]={ack:0,chunks:this._chunk(t)},n.debug&&(this._outgoing[this._count].timer=new Date),this._sendWindowedChunks(this._count),this._count+=1)},a.prototype._setupInterval=function(){var e=this;this._timeout=setInterval((function(){var t=e._queue.shift();if(t._multiple)for(var i=0,n=t.length;i<n;i+=1)e._intervalSend(t[i]);else e._intervalSend(t)}),this._interval)},a.prototype._intervalSend=function(e){var t=this;e=n.pack(e),n.blobToBinaryString(e,(function(e){t._dc.send(e)})),0===t._queue.length&&(clearTimeout(t._timeout),t._timeout=null)},a.prototype._processAcks=function(){for(var e in this._outgoing)this._outgoing.hasOwnProperty(e)&&this._sendWindowedChunks(e)},a.prototype._handleSend=function(e){for(var t=!0,i=0,n=this._queue.length;i<n;i+=1){var a=this._queue[i];(a===e||a._multiple&&-1!==a.indexOf(e))&&(t=!1)}t&&(this._queue.push(e),this._timeout||this._setupInterval())},a.prototype._setupDC=function(){var e=this;this._dc.onmessage=function(t){var i=t.data;if(i.constructor===String){var a=n.binaryStringToArrayBuffer(i);i=n.unpack(a),e._handleMessage(i)}}},a.prototype._handleMessage=function(e){var t,i=e[1],a=this._incoming[i],o=this._outgoing[i];switch(e[0]){case"no":var s=i;s&&this.onmessage(n.unpack(s));break;case"end":if(t=a,this._received[i]=e[2],!t)break;this._ack(i);break;case"ack":if(t=o){var r=e[2];t.ack=Math.max(r,t.ack),t.ack>=t.chunks.length?(n.log("Time: ",new Date-t.timer),delete this._outgoing[i]):this._processAcks()}break;case"chunk":if(!(t=a)){if(!0===this._received[i])break;t={ack:["ack",i,0],chunks:[]},this._incoming[i]=t}var c=e[2],u=e[3];t.chunks[c]=new Uint8Array(u),c===t.ack[2]&&this._calculateNextAck(i),this._ack(i);break;default:this._handleSend(e)}},a.prototype._chunk=function(e){for(var t=[],i=e.size,a=0;a<i;){var o=Math.min(i,a+this._mtu),s={payload:e.slice(a,o)};t.push(s),a=o}return n.log("Created",t.length,"chunks."),t},a.prototype._ack=function(e){var t=this._incoming[e].ack;this._received[e]===t[2]&&(this._complete(e),this._received[e]=!0),this._handleSend(t)},a.prototype._calculateNextAck=function(e){for(var t=this._incoming[e],i=t.chunks,n=0,a=i.length;n<a;n+=1)if(void 0===i[n])return void(t.ack[2]=n);t.ack[2]=i.length},a.prototype._sendWindowedChunks=function(e){n.log("sendWindowedChunks for: ",e);for(var t=this._outgoing[e],i=t.chunks,a=[],o=Math.min(t.ack+this._window,i.length),s=t.ack;s<o;s+=1)i[s].sent&&s!==t.ack||(i[s].sent=!0,a.push(["chunk",e,s,i[s].payload]));t.ack+this._window>=i.length&&a.push(["end",e,i.length]),a._multiple=!0,this._handleSend(a)},a.prototype._complete=function(e){n.log("Completed called for",e);var t=this,i=this._incoming[e].chunks,a=new Blob(i);n.blobToArrayBuffer(a,(function(e){t.onmessage(n.unpack(e))})),delete this._incoming[e]},a.higherBandwidthSDP=function(e){var t=navigator.appVersion.match(/Chrome\/(.*?) /);if(t&&(t=parseInt(t[1].split(".").shift()))<31){var i=e.split("b=AS:30");if(1<i.length)return i[0]+"b=AS:102400"+i[1]}return e},a.prototype.onmessage=function(e){},t.exports.Reliable=a},{"./util":13}],13:[function(e,t,i){var n=e("js-binarypack"),a={debug:!1,inherits:function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},pack:n.pack,unpack:n.unpack,log:function(){if(a.debug){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.unshift("Reliable: "),console.log.apply(console,e)}},setZeroTimeout:function(e){var t=[],i="zero-timeout-message";function n(n){n.source==e&&n.data==i&&(n.stopPropagation&&n.stopPropagation(),t.length&&t.shift()())}return e.addEventListener?e.addEventListener("message",n,!0):e.attachEvent&&e.attachEvent("onmessage",n),function(n){t.push(n),e.postMessage(i,"*")}}(this),blobToArrayBuffer:function(e,t){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsArrayBuffer(e)},blobToBinaryString:function(e,t){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};t.exports=a},{"js-binarypack":10}]},{},[3])},function(e,t,i){var n={"./909.wav":394,"./909b.wav":395,"./909closed.wav":396,"./909open.wav":397,"./CARinsect.wav":398,"./Cryptotympana.wav":399,"./Dundunia.wav":400,"./InsectBee.wav":401,"./InsectBee2.wav":402,"./InsectFly.wav":403,"./InsecticideZG.wav":404,"./Macrosemia.wav":405,"./MacrosemiaTonk.wav":406,"./MeimunaNau.wav":407,"./auboom.wav":408,"./auboom2.wav":409,"./auclick.wav":410,"./audoubelclick2.wav":411,"./audoubleclick.wav":412,"./auhiclick.wav":413,"./ausiclick.wav":414,"./backswing-old1.wav":415,"./bee.wav":416,"./bello.wav":417,"./bellrip.wav":418,"./bellrip2.wav":419,"./bellrip3.wav":420,"./bellx.wav":421,"./birta.wav":422,"./blade-old1.wav":423,"./boom.wav":424,"./boom2.wav":425,"./boomwag.wav":426,"./camclick-old1.wav":427,"./camina1.wav":428,"./camina2.wav":429,"./camina3.wav":430,"./camina4.wav":431,"./chain.wav":432,"./chainSpade.wav":433,"./click-old1.wav":434,"./click.wav":435,"./clicko-old1.wav":436,"./clicko.wav":437,"./clicks1.wav":438,"./convol1.wav":439,"./convol2.wav":440,"./convol3.wav":441,"./convol4.wav":442,"./convol5.wav":443,"./crackle3.wav":444,"./crickBee.wav":445,"./dalispark.wav":446,"./dentist-old1.wav":447,"./digaa.wav":448,"./dorje.wav":449,"./drone1.wav":450,"./drone2.wav":451,"./drr.wav":452,"./electro.wav":453,"./elstatic-old1.wav":454,"./firecrack.wav":455,"./firespark.wav":456,"./firespark2.wav":457,"./flash-old1.wav":458,"./glitch-old1.wav":459,"./hapsi.wav":460,"./harshi-old1.wav":461,"./harshlow-old1.wav":462,"./heart.wav":463,"./holeMONO.wav":464,"./ice.wav":465,"./insec.wav":466,"./insec2.wav":467,"./insec3.wav":468,"./insectzapZG.wav":469,"./iron.wav":470,"./ironrip.wav":471,"./jump.wav":472,"./kernel.wav":473,"./kernel2.wav":474,"./kerneldrone.wav":475,"./kernelmix.wav":476,"./kicic.wav":477,"./kicic2.wav":478,"./kicicboom.wav":479,"./knock.wav":480,"./laekur.wav":481,"./lookout.wav":482,"./machine.wav":483,"./magnetclock-old1.wav":484,"./noinoi.wav":485,"./noise-old1.wav":486,"./noise1.wav":487,"./noise2.wav":488,"./paper.wav":489,"./pattern10.wav":490,"./pattern11.wav":491,"./pattern8.wav":492,"./pattern9.wav":493,"./patterndrone.wav":494,"./patterndrone2.wav":495,"./patterndrone3.wav":496,"./phoo-old1.wav":497,"./pork.wav":498,"./rain_ravi.wav":499,"./ravi.wav":500,"./revbell.wav":501,"./rocks.wav":502,"./rotatingIron.wav":503,"./sbq.wav":504,"./skake2Ed.wav":505,"./snork.wav":506,"./snow.wav":507,"./spade.wav":508,"./spark.wav":509,"./stretch.wav":510,"./sweetmachine-old1.wav":511,"./swipe-old1.wav":512,"./triplet.wav":513,"./vindva.wav":514,"./vindvabd.wav":515,"./vindvaclick.wav":516,"./vindvadbase.wav":517,"./vindvahat.wav":518,"./viromachine-old1.wav":519,"./woodsamp.wav":520,"./wooo-old1.wav":521,"./xylophone.wav":522,"./zhish.wav":523,"./zzzz.wav":524};function a(e){var t=o(e);return i(t)}function o(e){if(!i.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}a.keys=function(){return Object.keys(n)},a.resolve=o,e.exports=a,a.id=530},function(e,t,i){var n={"./909.wav":394,"./909b.wav":395,"./909closed.wav":396,"./909open.wav":397,"./CARinsect.wav":398,"./Cryptotympana.wav":399,"./Dundunia.wav":400,"./InsectBee.wav":401,"./InsectBee2.wav":402,"./InsectFly.wav":403,"./InsecticideZG.wav":404,"./Macrosemia.wav":405,"./MacrosemiaTonk.wav":406,"./MeimunaNau.wav":407,"./auboom.wav":408,"./auboom2.wav":409,"./auclick.wav":410,"./audoubelclick2.wav":411,"./audoubleclick.wav":412,"./auhiclick.wav":413,"./ausiclick.wav":414,"./backswing-old1.wav":415,"./bee.wav":416,"./bello.wav":417,"./bellrip.wav":418,"./bellrip2.wav":419,"./bellrip3.wav":420,"./bellx.wav":421,"./birta.wav":422,"./blade-old1.wav":423,"./boom.wav":424,"./boom2.wav":425,"./boomwag.wav":426,"./camclick-old1.wav":427,"./camina1.wav":428,"./camina2.wav":429,"./camina3.wav":430,"./camina4.wav":431,"./chain.wav":432,"./chainSpade.wav":433,"./click-old1.wav":434,"./click.wav":435,"./clicko-old1.wav":436,"./clicko.wav":437,"./clicks1.wav":438,"./convol1.wav":439,"./convol2.wav":440,"./convol3.wav":441,"./convol4.wav":442,"./convol5.wav":443,"./crackle3.wav":444,"./crickBee.wav":445,"./dalispark.wav":446,"./dentist-old1.wav":447,"./digaa.wav":448,"./dorje.wav":449,"./drone1.wav":450,"./drone2.wav":451,"./drr.wav":452,"./electro.wav":453,"./elstatic-old1.wav":454,"./firecrack.wav":455,"./firespark.wav":456,"./firespark2.wav":457,"./flash-old1.wav":458,"./glitch-old1.wav":459,"./hapsi.wav":460,"./harshi-old1.wav":461,"./harshlow-old1.wav":462,"./heart.wav":463,"./holeMONO.wav":464,"./ice.wav":465,"./insec.wav":466,"./insec2.wav":467,"./insec3.wav":468,"./insectzapZG.wav":469,"./iron.wav":470,"./ironrip.wav":471,"./jump.wav":472,"./kernel.wav":473,"./kernel2.wav":474,"./kerneldrone.wav":475,"./kernelmix.wav":476,"./kicic.wav":477,"./kicic2.wav":478,"./kicicboom.wav":479,"./knock.wav":480,"./laekur.wav":481,"./lookout.wav":482,"./machine.wav":483,"./magnetclock-old1.wav":484,"./noinoi.wav":485,"./noise-old1.wav":486,"./noise1.wav":487,"./noise2.wav":488,"./paper.wav":489,"./pattern10.wav":490,"./pattern11.wav":491,"./pattern8.wav":492,"./pattern9.wav":493,"./patterndrone.wav":494,"./patterndrone2.wav":495,"./patterndrone3.wav":496,"./phoo-old1.wav":497,"./pork.wav":498,"./rain_ravi.wav":499,"./ravi.wav":500,"./revbell.wav":501,"./rocks.wav":502,"./rotatingIron.wav":503,"./sbq.wav":504,"./skake2Ed.wav":505,"./snork.wav":506,"./snow.wav":507,"./spade.wav":508,"./spark.wav":509,"./stretch.wav":510,"./sweetmachine-old1.wav":511,"./swipe-old1.wav":512,"./triplet.wav":513,"./vindva.wav":514,"./vindvabd.wav":515,"./vindvaclick.wav":516,"./vindvadbase.wav":517,"./vindvahat.wav":518,"./viromachine-old1.wav":519,"./woodsamp.wav":520,"./wooo-old1.wav":521,"./xylophone.wav":522,"./zhish.wav":523,"./zzzz.wav":524};function a(e){return Promise.resolve().then((function(){if(!i.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i(n[e])}))}a.keys=function(){return Object.keys(n)},a.id=531,e.exports=a},,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";i.r(t),i.d(t,"AudioEngine",(function(){return l}));i.p,i.p,i.p,i.p;var n=i(160);const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=e=>64===Module.maxiTools._keyStr.indexOf(e.charAt(e.length-1))?e.substring(0,e.length-1):e;var s=i(5);class r{constructor(e){this.isConnected=!1,this.id=-1,this.messaging=new s.a;try{this.socket=new WebSocket("ws://localhost:8089")}catch(e){console.log("No sema_ticks, running without netclock.")}this.socket.addEventListener("open",function(e){console.log("Kura Clock websocket open"),this.clock.isConnected=!0,this.clock.socket.send("hello from sema")}.bind({clock:this})),this.socket.addEventListener("close",function(e){console.log("Kura Clock websocket closed"),this.clock.isConnected=!1}.bind({clock:this})),this.peerQueryResponseFunction=null,this.socket.addEventListener("message",function(e){console.log("Message from server ",e.data);try{let t=JSON.parse(e.data);switch(t.r){case"p":this.clock.peerQueryResponseFunction(t.n);break;case"o":this.clock.messaging("clock-phase",{phase:t.v,i:t.i})}}catch(e){console.log("Clock message error: "+e)}}.bind({clock:this}))}queryPeers(e){this.isConnected?(this.peerQueryResponseFunction=e,this.socket.send(JSON.stringify({c:"q"}))):e(1)}connected(){return this.isConnected}broadcastPhase(e){this.isConnected&&this.socket.send(JSON.stringify({c:"o",phase:e}))}}i(529);var c=i(44);class u extends AudioWorkletNode{constructor(e,t){console.log(),super(e,t,{numberOfInputs:1,numberOfOutputs:1,outputChannelCount:[e.destination.maxChannelCount]})}}class l{constructor(){if(l.instance)return l.instance;l.instance=this,this.audioContext,this.audioWorkletProcessorName="maxi-processor",this.audioWorkletUrl="/maxi-processor.js",this.audioWorkletNode,this.samplesLoaded=!1,this.analysers={},this.sabs={},this.messaging=new s.a,this.messaging.subscribe("eval-dsp",e=>this.evalDSP(e)),this.messaging.subscribe("stop-audio",e=>this.stop()),this.messaging.subscribe("load-sample",(e,t)=>this.loadSample(e,t)),this.messaging.subscribe("model-output-data",e=>this.onMessagingEventHandler(e)),this.messaging.subscribe("clock-phase",e=>this.onMessagingEventHandler(e)),this.messaging.subscribe("model-send-buffer",e=>this.onMessagingEventHandler(e)),this.messaging.subscribe("add-engine-analyser",e=>this.createAnalyser(e)),this.messaging.subscribe("remove-engine-analyser",e=>this.removeAnalyser(e)),this.messaging.subscribe("mouse-xy",e=>{this.sabs.mxy&&this.sabs.mxy.rb.push(e)}),this.messaging.subscribe("sequencerTrigger",e=>{let t=e.channel;void 0!==this.sabs[t]&&this.sabs[t].rb.push(new Float32Array([e.signal]))}),this.kuraClock=new r,this.messaging.subscribe("peermsg",e=>{e.ttype="NET",e.peermsg=1,this.onMessagingEventHandler(e)}),this.messaging.subscribe("peerinfo-request",e=>{console.log(this.peerNet.peerID),Object(c.a)(this.peerNet.peerID)})}onProcessorMessageEventHandler(e){if(null!=e&&null!=e.data)if("giveMeSomeSamples"===e.data);else if(null!=e.data.phase)this.kuraClock.broadcastPhase(e.data.phase);else if(null!=e.data.rq&&"send"===e.data.rq)switch(e.data.ttype){case"ML":this.messaging.publish("model-input-data",{type:"model-input-data",value:e.data.value,ch:e.data.ch});break;case"NET":this.peerNet.send(e.data.ch[0],e.data.value,e.data.ch[1])}else if(e.data.rq&&"buf"===e.data.rq)switch(console.log("buf",e.data),e.data.ttype){case"ML":this.messaging.publish("model-input-buffer",{type:"model-input-buffer",value:e.data.value,channelID:e.data.channelID,blocksize:e.data.blocksize})}}onMessagingEventHandler(e){void 0!==e&&(console.log("DEBUG:AudioEngine:onMessagingEventHandler:"),console.log(e),this.audioWorkletNode.port.postMessage(e))}createAnalyser(e){if(void 0!==this.audioContext&&void 0!==e){let t=this.audioContext.createAnalyser();t.smoothingTimeConstant=.25,t.fftSize=256,t.minDecibels=-90,t.maxDecibels=-0,this.connectAnalyser(t,e.id)}else void 0===this.audioContext&&(this.analysers[e.id]={})}pollAnalyserData(e){if(void 0!==e){const t=new Uint8Array(e.fftSize),i=new Uint8Array(e.fftSize);return e.getByteTimeDomainData(t),e.getByteFrequencyData(i),{smoothingTimeConstant:e.smoothingTimeConstant,fftSize:e.fftSize,frequencyDataArray:i,timeDataArray:t}}}connectAnalyser(e,t){if(void 0!==this.audioWorkletNode){let i;this.audioWorkletNode.connect(e);const n=()=>{i=this.pollAnalyserData(e),this.messaging.publish("analyser-data",i);let a=requestAnimationFrame(n);return this.analysers[t]={analyser:e,analyserFrameId:a},a};n()}}connectAnalysers(){Object.keys(this.analysers).map(e=>this.createAnalyser({id:e}))}removeAnalyser(e){if(void 0!==this.audioContext&&void 0!==this.audioWorkletNode){void 0!==this.analysers[e.id]&&(cancelAnimationFrame(this.analysers[e.id].analyserFrameId),delete this.analysers[e.id])}}createSAB(e,t,i,a){let o=n.RingBuffer.getStorageForCapacity(32*i,Float64Array),s=new n.RingBuffer(o,Float64Array);a.postMessage({func:"sab",value:o,ttype:t,channelID:e,blocksize:i}),this.sabs[e]={sab:o,rb:s},console.log(this.sabs)}async init(e){if(void 0===this.audioContext){this.audioContext=new AudioContext({latencyHint:"playback"}),this.audioContext.destination.channelInterpretation="discrete",this.audioContext.destination.channelCountMode="explicit",this.audioContext.destination.channelCount=this.audioContext.destination.maxChannelCount,console.log(this.audioContext.destination),await this.loadWorkletProcessorCode(),this.audioWorkletNode.channelInterpretation="discrete",this.audioWorkletNode.channelCountMode="explicit",this.audioWorkletNode.channelCount=this.audioContext.destination.maxChannelCount,this.connectMediaStream(),this.connectAnalysers(),this.loadImportedSamples(),this.createSAB("mxy","mouseXY",2,this.audioWorkletNode.port);for(let e=0;e<=64;e++)this.createSAB(e,"sequencerTrigger",1,this.audioWorkletNode.port)}}play(){if(void 0!==this.audioContext)return"suspended"!==this.audioContext.state?(this.stop(),!1):(this.audioContext.resume(),!0)}stop(){void 0!==this.audioWorkletNode&&this.audioContext.suspend()}stopAndRelease(){void 0!==this.audioWorkletNode&&(this.audioWorkletNode.disconnect(this.audioContext.destination),this.audioWorkletNode=void 0)}more(e){if(void 0!==this.audioWorkletNode){const t=this.audioWorkletNode.parameters.get(e);return t.value+=.5,console.log(e+": "+t.value),!0}return!1}less(e){if(void 0!==this.audioWorkletNode){const t=this.audioWorkletNode.parameters.get(e);return t.value-=.5,console.log(e+": "+t.value),!0}return!1}evalDSP(e){return console.log("DEBUG:AudioEngine:evalDSP:"),console.log(e),void 0!==this.audioWorkletNode&&("suspended"===this.audioContext.state&&this.audioContext.resume(),this.audioWorkletNode.port.postMessage({eval:1,setup:e.setup,loop:e.loop}),!0)}sendClockPhase(e,t){void 0!==this.audioWorkletNode&&this.audioWorkletNode.port.postMessage({phase:e,i:t})}onAudioInputInit(e){this.audioContext.createMediaStreamSource(e).connect(this.audioWorkletNode)}onAudioInputFail(e){console.log(`DEBUG:AudioEngine:AudioInputFail: ${e.message} ${e.name}`)}async connectMediaStream(){const e=window.constraints={audio:!0,video:!1};navigator.mediaDevices.getUserMedia(e).then(e=>this.onAudioInputInit(e)).catch(this.onAudioInputFail)}async loadWorkletProcessorCode(){if(void 0===this.audioContext)return!1;try{return await this.audioContext.audioWorklet.addModule(this.audioWorkletUrl),this.audioWorkletNode=new u(this.audioContext,this.audioWorkletProcessorName),this.audioWorkletNode.onprocessorerror=e=>{console.log("DEBUG:AudioEngine:loadWorkletProcessorCode: MaxiProcessor Error detected")},this.audioWorkletNode.port.onmessageerror=e=>{console.log("DEBUG:AudioEngine:loadWorkletProcessorCode: Error message from port: "+e.data)},this.audioWorkletNode.onprocessorstatechange=e=>{console.log("DEBUG:AudioEngine:loadWorkletProcessorCode: MaxiProcessor state change detected: "+audioWorkletNode.processorState)},this.audioWorkletNode.port.onmessage=e=>{this.onProcessorMessageEventHandler(e)},this.audioWorkletNode.connect(this.audioContext.destination),console.log(this.audioContext.destination),!0}catch(e){return console.log("DEBUG:AudioEngine:loadWorkletProcessorCode: AudioWorklet not supported in this browser: ",e.message),!1}}getSamplesNames(){return(e=>e.keys().map(e=>e.match(/[^\/]+$/)[0]))(i(530))}loadSample(e,t){if(void 0===this.audioContext)throw"Audio Context is not initialised!";((e,t,i,n)=>{var s=[],r=(e=>{if(-1!==e.indexOf(";base64,")){var t=e.indexOf(";base64,")+8;return!!e.slice(t).match(/^([A-Za-z0-9+\/]{4})*([A-Za-z0-9+\/]{4}|[A-Za-z0-9+\/]{3}=|[A-Za-z0-9+\/]{2}==)$/)&&e.slice(t)}return!1})(i);if(r){var c=r.length/4*3,u=new ArrayBuffer(c);r=o(o(r));var l,p,d,h,f,v,w,m=parseInt(r.length/4*3,10),g=0,k=0;for(l=new Uint8Array(u),r=r.replace(/[^A-Za-z0-9\+\/\=]/g,""),g=0;g<m;g+=3)p=a.indexOf(r.charAt(k++))<<2|(f=a.indexOf(r.charAt(k++)))>>4,d=(15&f)<<4|(v=a.indexOf(r.charAt(k++)))>>2,h=(3&v)<<6|(w=a.indexOf(r.charAt(k++))),l[g]=p,64!==v&&(l[g+1]=d),64!==w&&(l[g+2]=h);e.decodeAudioData(u,(function(e){let i=e.getChannelData(0);void 0!==s&&void 0!==n&&n.port.postMessage({sample:t,buffer:i})}),(function(e){console.log("Error decoding source!")}))}else{var _=new XMLHttpRequest;_.addEventListener("load",()=>console.log("The transfer is complete.")),_.open("GET",i,!0),_.responseType="arraybuffer",_.onload=function(){e.decodeAudioData(_.response,(function(e){let i=e.getChannelData(0);void 0!==s&&void 0!==n&&n.port.postMessage({sample:t,buffer:i})}),(function(e){console.log("Error decoding source!")}))},_.send()}})(this.audioContext,e,t,this.audioWorkletNode)}lazyLoadSample(e){i(531)("./"+e).then(()=>this.loadSample(e,"/samples/"+e)).catch(e=>console.error("DEBUG:AudioEngine:lazyLoadSample: "+e))}loadImportedSamples(){this.getSamplesNames().forEach(e=>{this.lazyLoadSample(e)})}}}])]);